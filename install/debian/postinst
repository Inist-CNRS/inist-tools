#!/usr/bin/env bash
################################################################################
#
# INIST-TOOLS INSTALLATION : POST-INSTALLATION
#
################################################################################

# ------------------------------------------------------------------------------
# Variables globales
# ------------------------------------------------------------------------------
# USER=$(logname)
USER=$(who am i | awk '{print $1}' | head -1)

# ------------------------------------------------------------------------------
# Installation des dépendances
# ------------------------------------------------------------------------------
# on exporte le proxy pour avoir accès au net
# export http_proxy=http://proxyout.inist.fr:8080
# export HTTP_PROXY=http://proxyout.inist.fr:8080
# export https_proxy=http://proxyout.inist.fr:8080
# export HTTPS_PROXY=http://proxyout.inist.fr:8080
# export no_proxy=localhost,127.0.0.0/8,*.local
#
# apt-get install -y make ntpdate parallel jq sudo libnotify-bin

# ------------------------------------------------------------------------------
# Protection des fichiers /etc/sudoers.d/*
# ------------------------------------------------------------------------------
chmod 600 /etc/sudoers.d/inist-tools

# ------------------------------------------------------------------------------
# Répêrtoire de stockage de l'environnement d'execution d'inist-tools
# ------------------------------------------------------------------------------
ENV_DIR="/opt/inist-tools/env"
if [ ! -d "$ENV_DIR" ]; then
   mkdir -p "$ENV_DIR"
fi
chown -R "$USER":"$USER" "$ENV_DIR"
chmod -R 777 "$ENV_DIR"

# ------------------------------------------------------------------------------
# On redevient le user courant
# ------------------------------------------------------------------------------
# su "$USER"

# ------------------------------------------------------------------------------
# Installation dans le .bashrc de l'utilisateur
# ------------------------------------------------------------------------------
# --- on laisse l'utilisateur modifier son propre .bashrc
# echo -e "\n" >> "$HOME/.bashrc"
# echo "# inist-tools" >> "$HOME/.bashrc"
# echo ". /opt/inist-tools/inistrc # inist-tools" >> "$HOME/.bashrc"


# ------------------------------------------------------------------------------
# FIN !
# ------------------------------------------------------------------------------
# exit 0
